/*********************************************************
文件名：lcd.c
功能  ：LCD的初始化及其功能函数
作者  ：严超彬
日期  :2014/12/25
**********************************************************/
/**@supplement	8行8列*/
#include "rbc_lcd.h"
unsigned char const num_table[]={"0123456789ABCDEF"};
unsigned char const font5x8[][5]={
0x00, 0x00, 0x00, 0x00, 0x00,   // sp     
0x00, 0x00, 0x2f, 0x00, 0x00,   // !     
0x00, 0x07, 0x00, 0x07, 0x00,   // "     
0x14, 0x7f, 0x14, 0x7f, 0x14,   // #     
0x24, 0x2a, 0x7f, 0x2a, 0x12,   // $     
0x62, 0x64, 0x08, 0x13, 0x23,   // %     
0x36, 0x49, 0x55, 0x22, 0x50,   // &     
0x00, 0x05, 0x03, 0x00, 0x00,   // ’     
0x00, 0x1c, 0x22, 0x41, 0x00,   // (     
0x00, 0x41, 0x22, 0x1c, 0x00,   // )     
0x14, 0x08, 0x3E, 0x08, 0x14,   // *     
0x08, 0x08, 0x3E, 0x08, 0x08,   // +     
0x00, 0x00, 0xA0, 0x60, 0x00,   // ,     
0x08, 0x08, 0x08, 0x08, 0x08,   // -     
0x00, 0x60, 0x60, 0x00, 0x00,   // .     
0x20, 0x10, 0x08, 0x04, 0x02,   // /     
0x3E, 0x51, 0x49, 0x45, 0x3E,   // 0     
0x00, 0x42, 0x7F, 0x40, 0x00,   // 1     
0x42, 0x61, 0x51, 0x49, 0x46,   // 2     
0x21, 0x41, 0x45, 0x4B, 0x31,   // 3     
0x18, 0x14, 0x12, 0x7F, 0x10,   // 4     
0x27, 0x45, 0x45, 0x45, 0x39,   // 5     
0x3C, 0x4A, 0x49, 0x49, 0x30,   // 6     
0x01, 0x71, 0x09, 0x05, 0x03,   // 7     
0x36, 0x49, 0x49, 0x49, 0x36,   // 8     
0x06, 0x49, 0x49, 0x29, 0x1E,   // 9     
0x00, 0x36, 0x36, 0x00, 0x00,   // :     
0x00, 0x56, 0x36, 0x00, 0x00,   // ;     
0x08, 0x14, 0x22, 0x41, 0x00,   // <     
0x14, 0x14, 0x14, 0x14, 0x14,   // =     
0x00, 0x41, 0x22, 0x14, 0x08,   // >     
0x02, 0x01, 0x51, 0x09, 0x06,   // ?     
0x32, 0x49, 0x59, 0x51, 0x3E,   // @     
0x7C, 0x12, 0x11, 0x12, 0x7C,   // A     
0x7F, 0x49, 0x49, 0x49, 0x36,   // B     
0x3E, 0x41, 0x41, 0x41, 0x22,   // C     
0x7F, 0x41, 0x41, 0x22, 0x1C,   // D     
0x7F, 0x49, 0x49, 0x49, 0x41,   // E     
0x7F, 0x09, 0x09, 0x09, 0x01,   // F     
0x3E, 0x41, 0x49, 0x49, 0x7A,   // G     
0x7F, 0x08, 0x08, 0x08, 0x7F,   // H     
0x00, 0x41, 0x7F, 0x41, 0x00,   // I     
0x20, 0x40, 0x41, 0x3F, 0x01,   // J     
0x7F, 0x08, 0x14, 0x22, 0x41,   // K     
0x7F, 0x40, 0x40, 0x40, 0x40,   // L:0x7F, 0x40, 0x40, 0x40, 0x40     
0x7F, 0x02, 0x0C, 0x02, 0x7F,   // M     
0x7F, 0x04, 0x08, 0x10, 0x7F,   // N     
0x3E, 0x41, 0x41, 0x41, 0x3E,   // O     
0x7F, 0x09, 0x09, 0x09, 0x06,   // P     
0x3E, 0x41, 0x51, 0x21, 0x5E,   // Q     
0x7F, 0x09, 0x19, 0x29, 0x46,   // R     
0x46, 0x49, 0x49, 0x49, 0x31,   // S     
0x01, 0x01, 0x7F, 0x01, 0x01,   // T     
0x3F, 0x40, 0x40, 0x40, 0x3F,   // U     
0x1F, 0x20, 0x40, 0x20, 0x1F,   // V     
0x3F, 0x40, 0x38, 0x40, 0x3F,   // W     
0x63, 0x14, 0x08, 0x14, 0x63,   // X     
0x07, 0x08, 0x70, 0x08, 0x07,   // Y     
0x61, 0x51, 0x49, 0x45, 0x43,   // Z     
0x00, 0x7F, 0x41, 0x41, 0x00,   // [     
0x55, 0x2A, 0x55, 0x2A, 0x55,   // 55     
0x00, 0x41, 0x41, 0x7F, 0x00,   // ]     
0x04, 0x02, 0x01, 0x02, 0x04,   // ^     
0x00, 0x40, 0x40, 0x40, 0x40,   // _:0x40, 0x40, 0x40, 0x40, 0x40     
0x00, 0x01, 0x02, 0x04, 0x00,   // ’     
0x20, 0x54, 0x54, 0x54, 0x78,   // a     
0x7F, 0x48, 0x44, 0x44, 0x38,   // b     
0x38, 0x44, 0x44, 0x44, 0x20,   // c     
0x38, 0x44, 0x44, 0x48, 0x7F,   // d     
0x38, 0x54, 0x54, 0x54, 0x18,   // e     
0x08, 0x7E, 0x09, 0x01, 0x02,   // f     
0x18, 0xA4, 0xA4, 0xA4, 0x7C,   // g     
0x7F, 0x08, 0x04, 0x04, 0x78,   // h     
0x00, 0x44, 0x7D, 0x40, 0x00,   // i     
0x40, 0x80, 0x84, 0x7D, 0x00,   // j     
0x7F, 0x10, 0x28, 0x44, 0x00,   // k     
0x00, 0x41, 0x7F, 0x40, 0x00,   // l     
0x7C, 0x04, 0x18, 0x04, 0x78,   // m     
0x7C, 0x08, 0x04, 0x04, 0x78,   // n     
0x38, 0x44, 0x44, 0x44, 0x38,   // o     
0xFC, 0x24, 0x24, 0x24, 0x18,   // p     
0x18, 0x24, 0x24, 0x18, 0xFC,   // q     
0x7C, 0x08, 0x04, 0x04, 0x08,   // r     
0x48, 0x54, 0x54, 0x54, 0x20,   // s     
0x04, 0x3F, 0x44, 0x40, 0x20,   // t     
0x3C, 0x40, 0x40, 0x20, 0x7C,   // u     
0x1C, 0x20, 0x40, 0x20, 0x1C,   // v     
0x3C, 0x40, 0x30, 0x40, 0x3C,   // w     
0x44, 0x28, 0x10, 0x28, 0x44,   // x     
0x1C, 0xA0, 0xA0, 0xA0, 0x7C,   // y     
0x44, 0x64, 0x54, 0x4C, 0x44,   // z     
0x00, 0x08, 0x36, 0x41, 0x00,   // {     
0x00, 0x00, 0x7F, 0x00, 0x00,   // |     
0x00, 0x41, 0x36, 0x08, 0x00,   // }     
0x08, 0x10, 0x08, 0x04, 0x08    // ~ 
};


#define Up_to_Down


void LCD_GPIO_Config(void)
{
	/* BCar*/
	GPIO_Config(RBC_LCD_GPIOX, RBC_LCD_PINX, GPIO_Mode_OUT,GPIO_OType_PP, GPIO_PuPd_NOPULL);
}


void ROC_LCD_Init(void)
{
	LCD_GPIO_Config();
	RES(0);
	RES(1);
	Send_Command(0xe2); //软复位
	Send_Command(0x2c); //升压步骤1
	Send_Command(0x2e); //升压步骤2
	Send_Command(0x2f); //升压步骤3
	Send_Command(0x23); //粗调对比度，可设置范围 20～27   //0x23
	Send_Command(0x81); //微调对比度
	Send_Command(0x28); //微调对比度的值，可设置范围 0～63  //0x28
	Send_Command(0xa2); //1/9 偏压比（bias）
	#ifdef Up_to_Down/*******正显示*******/ 
		Send_Command(0xc8); //行扫描顺序：从上到下
		Send_Command(0xa0); //列扫描顺序：从左到右
	#else/*******倒显示*******/
		Send_Command(0xc0); //行扫描顺序：从下到上	
		Send_Command(0xa1); //列扫描顺序：从右到左
	#endif
	Send_Command(0xaf); //开显示
	Clear_LCD();
}


void Send_Command(unsigned char command)
{
	unsigned char i;
	CS(0);
	RS(0);
	for(i=0;i<8;i++)
	{
		SCLK(0);
		if(command&0x80)
		{
			SID(1);
		}
		else
		{
			SID(0);
		}
		SCLK(1);
		command<<=1;
	}
	CS(1);
}


void Send_data(unsigned char data)
{
	unsigned char i;
	CS(0);
	RS(1);
	for(i=0;i<8;i++)
	{
		SCLK(0);
		if(data&0x80)
		{
			SID(1);
		}
		else
		{
			SID(0);
		}
		SCLK(1);
		data<<=1;
	}
	CS(1);
}


/***********清屏函数**************/
void Clear_LCD(void)
{
	unsigned char i,j;
	for(i=0;i<8;i++)
	{
		LCD_set_XY(0,i);
		for(j=0;j<128;j++)
		{
			Send_data(0x00);
		}
	}
}


/***********设定光标坐标**************/
void LCD_set_XY(unsigned char X, unsigned char Y)
{
	X=X*6;
	Send_Command(0xb0+Y);
	#ifdef Up_to_Down /*******正显示*******/
		Send_Command(0x10+(X>>4));
		Send_Command(X&0x0f);
	#else/*******倒显示*******/		
		Send_Command(0x10+(X>>4));
		Send_Command(0x04+(X&0x0f));
	#endif
}

/***********************************************************
函数名称：LCD_write_char
函数功能：显示英文字符
入口参数：c	:  显示的字符
出口参数：无 
备 注： 
***********************************************************/
void LCD_write_char(unsigned char c)
{
   unsigned char i;
	c-=32;
   for (i=0;i<5; i++)
	{
   	Send_data(font5x8[c][i]);
	}
	Send_data(0x00);
}

/***********在指定的X,Y处显示字符串**************/
void LCD_Write_string(unsigned char *table,unsigned char X, unsigned char Y)
{
	LCD_set_XY(X,Y);	
	while(*table!=0)
	{
		LCD_write_char(*table++);
	}
}


/***********在指定的X,Y处显示整型数据**************/
void LCD_Display_int(signed int Data,unsigned char X, unsigned char Y)
{
	unsigned char Str[20];
	int2str(Data,Str);	
	LCD_Write_string(Str,X,Y);
	LCD_write_char(' ');//一般在显示完成之后再写一个空格，确保清掉上次显示遗留的数据
	LCD_write_char(' ');//一般在显示完成之后再写一个空格，确保清掉上次显示遗留的数据
}


/***********在指定的X,Y处显示浮点数据**************/
void LCD_Display_float(float Data,unsigned char X, unsigned char Y)
{
	unsigned char Str[20];
	float2str(Data,Str);	
	LCD_Write_string(Str,X,Y);
	LCD_write_char(' ');//一般在显示完成之后再写一个空格，确保清掉上次显示遗留的数据
	LCD_write_char(' ');//一般在显示完成之后再写一个空格，确保清掉上次显示遗留的数据
}


/***********浮点数据转字符串函数**************/
void float2str(float data,unsigned char*s)
{
	unsigned int num,lable=1000000000;
	unsigned char ii,tt;
	if(data<0)
	{
		*s++='-';
		data=-data;
	}
	num=(unsigned int)(data*1000);
	for(ii=9;ii>3;ii--)
	{
		if(num/lable)
		{
			break;
		}
		else
		{
		 	lable/=10;
		}
	}
	ii++;
	for(tt=0;tt<=ii;tt++)
	{
		if(ii-tt!=3)
		{
			*s++=num_table[num%(lable*10)/lable];
			lable/=10;
		}
		else
		{
			*s++='.';
		}
	}
	*s=0;
}


void int2str(signed int data,unsigned char*s)
{
	unsigned int lable=1000000000;

	if(data<0)
	{
		*s++='-';
		data=-data;
	}
	for(;;)
	{
		if((data/lable)||(lable==1))
		{break;}
		else
		{lable/=10;}
	}
	while(lable>=1)
	{
		*s++=num_table[data%(lable*10)/lable];
		lable/=10;
	}
	*s=0;
}





